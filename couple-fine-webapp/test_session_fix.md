# 세션 관리 수정 테스트 가이드

## 🔧 적용된 수정사항

### 1. React.StrictMode 대응
- `mounted` 플래그 추가로 언마운트 후 state 업데이트 방지
- 중복 구독 생성 문제 해결

### 2. USER_UPDATED 이벤트 스마트 처리
- 완전 차단 → 세션 유효성 검증으로 변경
- 정상적인 세션 갱신은 허용

### 3. 세션 갱신 주기 정상화
- 1분 → 10분으로 변경 (문서와 일치)
- 과도한 API 호출 감소

### 4. 정리(Cleanup) 개선
- 모든 비동기 작업에 mounted 체크 추가
- 타임아웃 정리 추가

## 📋 테스트 체크리스트

### 기본 테스트
- [ ] 로그인 정상 작동
- [ ] 10분 이상 대기 후에도 로그인 유지
- [ ] 탭 전환 시 세션 유지
- [ ] 브라우저 새로고침 후 세션 유지

### 심화 테스트
- [ ] 여러 탭 열어두고 테스트
- [ ] 네트워크 끊었다가 재연결
- [ ] 개발자 도구 열어서 로그 확인

## 🔍 콘솔 로그 확인 포인트

정상 동작 시 보이는 로그:
- `✅ 초기 세션 확인: 세션 있음`
- `🔔 Auth Event: TOKEN_REFRESHED Session exists: true`
- `✅ 로그인/토큰갱신 이벤트 처리: TOKEN_REFRESHED`
- `🔍 세션 상태 확인 중...` (10분마다)

문제가 있을 때 보이는 로그:
- `❌ 세션 없음 확인 - 로그아웃`
- `💥 세션 관리 오류:`

## 🎯 예상 결과

1. **더 이상 무작위 로그아웃이 발생하지 않음**
2. **USER_UPDATED 이벤트 시 세션 유지**
3. **10분마다 안정적인 세션 갱신**
4. **StrictMode에서도 정상 동작**

## 🚀 배포 전 체크

1. 로컬 테스트 완료
2. 콘솔 에러 없음 확인
3. 실제 사용 시나리오 테스트
4. 프로덕션 배포

## 💡 추가 권장사항

만약 여전히 문제가 있다면:

1. **Supabase 대시보드에서 JWT 설정 확인**
   - Auth Settings → JWT Expiry 시간 확인 (기본 3600초)
   - 너무 짧으면 더 길게 설정 권장

2. **브라우저 쿠키/localStorage 확인**
   - 개발자 도구 → Application → Storage 확인
   - sb-* 쿠키들이 정상적으로 있는지 확인

3. **다중 탭 동기화 테스트**
   - Broadcast Channel API 활용 고려